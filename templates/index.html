<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, target-densitydpi=medium-dpi"/>
    <title>TEST</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,eyJpbmJvdW5kcyI6IFt7InBvcnQiOiAxMDAwMSwgInByb3RvY29sIjogInZtZXNzIiwgInNldHRpbmdzIjogeyJjbGllbnRzIjogW3siaWQiOiAiOWQ2MTc2OGEtY2YzNy00MDRkLTljYTktZTdkZDRjZTY5M2M1IiwgImFsdGVySWQiOiA2NH1dfSwgInN0cmVhbVNldHRpbmdzIjogeyJuZXR3b3JrIjogIndzIiwgIndzU2V0dGluZ3MiOiB7InBhdGgiOiAiL3YifX19LCB7InBvcnQiOiAxMDAwMiwgInByb3RvY29sIjogInNvY2tzIiwgInNldHRpbmdzIjoge30sICJzdHJlYW1TZXR0aW5ncyI6IHsibmV0d29yayI6ICJ3cyIsICJ3c1NldHRpbmdzIjogeyJwYXRoIjogIi93cyJ9fX0sIHsicG9ydCI6IDEwMDAzLCAicHJvdG9jb2wiOiAic2hhZG93c29ja3MiLCAic2V0dGluZ3MiOiB7Im1ldGhvZCI6ICJjaGFjaGEyMCIsICJwYXNzd29yZCI6ICIxMjMifX1dLCAib3V0Ym91bmRzIjogW3sicHJvdG9jb2wiOiAiZnJlZWRvbSIsICJzZXR0aW5ncyI6IHt9fV19"/>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/epoch-charting@0.8.4/dist/css/epoch.min.css"/>
    <style>
      body {
        padding-top: 20px;
      }

      .container {
        max-width: 576px;
      }

      .epoch {
        width: 100%;
        height: 100px;
      }
    </style>
  </head>
  <body>

    <div class="container">
      <div class="jumbotron">
        <h5>
          <a href="/">
            Server-sent events support for aiohttp
          </a>
        </h5>

        <p id="ua">
        </p>

        <hr/>

        <h6>TEST0</h6>
        <div id="test0" class="epoch"/>

        <h6>TEST1</h6>
        <div id="test1" class="epoch"/>

        <h6>TEST2</h6>
        <div id="test2" class="epoch"/>

        <h6>TEST3</h6>
        <div id="test3" class="epoch"/>

      </div>

      <div class="footer">
        <p>
          <span class="float-right">
            <span id="ver"/>
          </span>
        </p>
      </div>
    </div>

    <script src="//cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"/>
    <script src="//cdn.jsdelivr.net/npm/popper.js@1.15.0/dist/umd/popper.min.js"/>
    <script src="//cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"/>
    <script src="//cdn.jsdelivr.net/npm/d3@3.5.17/d3.min.js"/>
    <script src="//cdn.jsdelivr.net/npm/epoch-charting@0.8.4/dist/js/epoch.min.js"/>
    <script>
      $(function () {
        $('#ua').text(navigator.userAgent);

        $.ajax({
          url: '/hello',
          success: function (data) {
            $('#ver').html(data.ver);
          }
        });

        /*
        var loc = window.location, new_uri;
        if (loc.protocol === "https:") {
          new_uri = "wss:";
        } else {
          new_uri = "ws:";
        }
        new_uri += "//" + loc.host;
        new_uri += loc.pathname + "test";

        var ws = new WebSocket(new_uri);
         */

        var charts = [];
        var charts_count = 4;

        for (var i=0;i&lt;charts_count;i++) {
          charts[i] = $('#test' + i).epoch({
            type: 'time.area',
            data: [{ label: 'foo' + i, values: [] }],
            axes: ['left', 'right', 'bottom']
          });
        }

        var evtSource = new EventSource('/sse_test');
        evtSource.onmessage = function(e) {
          var current = JSON.parse(e.data);
          for (var i=0;i&lt;charts_count;i++) {
            charts[i].push([current[i]]);
          }
        };

        /*
        ws.onmessage = function(msg) {
          var current = JSON.parse(msg.data);
          for (var i=0;i&lt;charts_count;i++) {
            charts[i].push([current[i]]);
          }
        };
         */
      });
    </script>

  </body>
</html>